CREATE TABLE quiz_version (id BIGINT, format SMALLINT NOT NULL, message TEXT, description1 TEXT, description2 TEXT, questions_per_page SMALLINT DEFAULT 1 NOT NULL, result_format SMALLINT NOT NULL, result_type SMALLINT NOT NULL, show_accuracy TINYINT(1) DEFAULT '1' NOT NULL, login_position SMALLINT NOT NULL, login_text TEXT, result20 TEXT, result40 TEXT, result60 TEXT, result80 TEXT, result100 TEXT, title_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, created_by INT, updated_by INT, version BIGINT, PRIMARY KEY(id, version)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE quiz (id BIGINT AUTO_INCREMENT, format SMALLINT NOT NULL, message TEXT, description1 TEXT, description2 TEXT, questions_per_page SMALLINT DEFAULT 1 NOT NULL, result_format SMALLINT NOT NULL, result_type SMALLINT NOT NULL, show_accuracy TINYINT(1) DEFAULT '1' NOT NULL, login_position SMALLINT NOT NULL, login_text TEXT, result20 TEXT, result40 TEXT, result60 TEXT, result80 TEXT, result100 TEXT, title_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, created_by INT, updated_by INT, version BIGINT, INDEX title_id_idx (title_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE quiz_content_version (id BIGINT, quiz_id BIGINT NOT NULL, message TEXT NOT NULL, format SMALLINT NOT NULL, image_id BIGINT, image_link VARCHAR(255), is_valid TINYINT(1) NOT NULL, parent_id BIGINT DEFAULT 0 NOT NULL, total_count BIGINT DEFAULT 0 NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, created_by INT, updated_by INT, version BIGINT, PRIMARY KEY(id, version)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE quiz_content (id BIGINT AUTO_INCREMENT, quiz_id BIGINT NOT NULL, message TEXT NOT NULL, format SMALLINT NOT NULL, image_id BIGINT, image_link VARCHAR(255), is_valid TINYINT(1) NOT NULL, parent_id BIGINT DEFAULT 0 NOT NULL, total_count BIGINT DEFAULT 0 NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, created_by INT, updated_by INT, version BIGINT, INDEX parent_idx (parent_id), INDEX quiz_id_idx (quiz_id), INDEX image_id_idx (image_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE quiz_session (id BIGINT AUTO_INCREMENT, quiz_id BIGINT NOT NULL, name VARCHAR(255) NOT NULL, email VARCHAR(255) NOT NULL, ip VARCHAR(20) NOT NULL, agent_string VARCHAR(255) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX quiz_id_idx (quiz_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
ALTER TABLE quiz_version ADD CONSTRAINT quiz_version_id_quiz_id FOREIGN KEY (id) REFERENCES quiz(id) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE quiz ADD CONSTRAINT quiz_updated_by_sf_guard_user_id FOREIGN KEY (updated_by) REFERENCES sf_guard_user(id);
ALTER TABLE quiz ADD CONSTRAINT quiz_title_id_title_id FOREIGN KEY (title_id) REFERENCES title(id);
ALTER TABLE quiz ADD CONSTRAINT quiz_created_by_sf_guard_user_id FOREIGN KEY (created_by) REFERENCES sf_guard_user(id);
ALTER TABLE quiz_content_version ADD CONSTRAINT quiz_content_version_id_quiz_content_id FOREIGN KEY (id) REFERENCES quiz_content(id) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE quiz_content ADD CONSTRAINT quiz_content_updated_by_sf_guard_user_id FOREIGN KEY (updated_by) REFERENCES sf_guard_user(id);
ALTER TABLE quiz_content ADD CONSTRAINT quiz_content_quiz_id_quiz_id FOREIGN KEY (quiz_id) REFERENCES quiz(id);
ALTER TABLE quiz_content ADD CONSTRAINT quiz_content_image_id_image_id FOREIGN KEY (image_id) REFERENCES image(id);
ALTER TABLE quiz_content ADD CONSTRAINT quiz_content_created_by_sf_guard_user_id FOREIGN KEY (created_by) REFERENCES sf_guard_user(id);
ALTER TABLE quiz_session ADD CONSTRAINT quiz_session_quiz_id_quiz_id FOREIGN KEY (quiz_id) REFERENCES quiz(id);

-- //@UNDO

